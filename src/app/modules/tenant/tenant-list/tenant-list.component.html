<div class="content mt-5">
  <!-- Tenants Table -->
  <div class="card p-3 shadow-sm main-card">
    <!-- Tenants List Header with Icon -->
    <div class="row mb-4">
      <div class="col-4">
        <h4 class="d-flex align-items-center">
          <i class="fa fa-search me-2"></i> Search Tenants
        </h4>
      </div>
      <div class="col-8 text-end">
        <button class="btn btn-outline-dark rounded-pill me-2" (click)="onOpenCreateTenantModal(createTenantModal)">
          <i class="fa fa-user-plus" aria-hidden="true"></i> Create Tenant
        </button>

        <button class="btn btn-outline-dark rounded-pill" (click)="onExportBankelo()">
          <i class="fa fa-file-excel-o" aria-hidden="true"></i> Export Bankelo
        </button>
      </div>
    </div>

    <!-- Filter Row -->
    <div class="row tenant-list-filter-row align-items-center mb-2">
      <div class="col-md-4 mb-2 mb-md-0">
        <input type="search" class="form-control rounded-pill" placeholder="Search by tenant ID or custom domain"
          aria-label="Search" [formControl]="searchText" />
      </div>
      <div class="col d-flex justify-content-end align-items-center">
        <!-- <button class="btn btn-outline-success rounded-pill" (click)="onExportBankelo()">
          <i class="fa fa-file-excel-o me-2" aria-hidden="true"></i> Export Bankelo
        </button> -->
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="onboarding" (change)="onCheckCheckBox($event)" />
          <label class="form-check-label" for="onboarding">Onboarding</label>
        </div>
      </div>
    </div>

    <!-- Rows & Onboarding Filter -->
    <div class="row mt-1">
      <div class="col-2 d-flex justify-content-end align-items-center">
        <select class="form-select rounded-pill" (change)="onChangeNoOfRows($event)">
          <option *ngFor="let row of rows" [value]="row">{{ row }} rows</option>
        </select>
      </div>
      <div class="col d-flex justify-content-end align-items-center">
        <ngb-pagination class="d-flex justify-content-center mt-3" (pageChange)="onPageChange($event)"
          [collectionSize]="pagination.totalSize" [(page)]="pagination.page" [pageSize]="pagination.limit"
          [maxSize]="10" [rotate]="true" [ellipses]="false" [boundaryLinks]="true">
        </ngb-pagination>

      </div>
    </div>

    <!-- Tenant List Table -->
    <ng-container>
      <h5 class="d-flex align-items-center">
        <i class="fa fa-users me-2"></i>Tenants List
      </h5>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th scope="col">Tenant Name</th>
              <th scope="col">Tenant ID</th>
              <th scope="col">Custom Domain</th>
              <th scope="col" class="text-end">Onboarding <span>(Buckzy)</span></th>
              <!-- <th scope="col">Detail</th>
              <th scope="col">Bankelo</th>
              <th scope="col">GHL</th>
              <th scope="col" class="text-end">Actions</th>  -->
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="tenants.length; else noData">
              <tr *ngFor="let tenant of tenants" class="table-row-hover">
                <td>{{ tenant?.tenantName }}</td>
                <td [routerLink]="['/tenant/detail', 'test']" [state]="{ data: tenant }"><span class="tenantId">{{
                    tenant?.tenantId }}</span></td>
                <td>{{ tenant?.customDomain || "NA" }}</td>
                <td class="text-end">
                  <ng-container
                    *ngIf="tenant?.bankelo?.status === 'SUBMITTED_FOR_CUSTOMER' || tenant?.bankelo?.status === 'SUBMITTED_FOR_PARTY'">
                    <i class="fa fa-check-circle text-success me-1" aria-hidden="true"></i>
                    {{ tenant?.bankelo?.createdAt | date : "dd-MM-yyyy" }}
                  </ng-container>
                  <ng-container *ngIf="tenant?.bankelo?.status === 'PENDING'">
                    <i class="fa fa-hourglass-half text-warning me-1" aria-hidden="true"></i>
                    {{ tenant?.bankelo?.createdAt | date : "dd-MM-yyyy" }}
                  </ng-container>
                  <ng-container *ngIf="!tenant?.bankelo?.createdAt">NA</ng-container>
                </td>

                <!-- <td>
                  <button class="btn btn-outline-dark btn-sm" (click)="onOpenDetailModal(tenant)">View</button>
                </td>
                <td>
                  <button class="btn btn-outline-dark btn-sm" (click)="onOpenBankeloInfoModal(tenant)">View</button>
                </td>
                <td>
                  <button class="btn btn-outline-dark btn-sm" (click)="onOpenGHLInfoModal(tenant)">View</button>
                </td>
                <td class="text-end">
                  <div class="dropdown">
                    <button class="btn btn-outline-dark btn-sm dropdown-toggle" type="button" id="actionsDropdown"
                      data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="fa fa-cogs"></i>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="actionsDropdown">
                      <li><button class="dropdown-item" (click)="openUpdateTenantModal(tenant,updateTenantModal)">
                          <i class="fa fa-edit me-1" aria-hidden="true"></i> Update CD</button>
                      </li>
                      <li><button class="dropdown-item" (click)="onConfirmation('PUBLIC', publicModal)">
                          <i class="fa fa-globe me-1" aria-hidden="true"></i> Make Public</button>
                      </li>
                      <li><button class="dropdown-item" (click)="onConfirmation('PRIVATE', privateModal)">
                          <i class="fa fa-lock me-1" aria-hidden="true"></i> Make Private</button>
                      </li>
                      <li><button class="dropdown-item" (click)="onConfirmation('STOP', stopModal)">
                          <i class="fa fa-stop-circle me-1" aria-hidden="true"></i> Stop</button>
                      </li>
                      <li><button class="dropdown-item" (click)="onConfirmation('RESTART', restartModal)">
                          <i class="fa fa-refresh me-1" aria-hidden="true"></i> Restart</button>
                      </li>
                      <li><button class="dropdown-item" (click)="openUploadAppleDevFile(tenant, appleDevModal)">
                          <i class="fa fa-upload me-1" aria-hidden="true"></i> Upload ADF</button>
                      </li>
                    </ul>
                  </div>
                </td> -->
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
    </ng-container>

    <!-- No Data Template -->
    <ng-template #noData>
      <td colspan="8">
        <div class="no-data-container d-flex align-items-center justify-content-center text-center"
          style="height: 54vh;">
          <div class="p-4 bounce-in-animation">
            <i class="bi bi-folder-x fs-1 mb-3 icon-bounce-in" style="color: #ff6f61;"></i> <!-- Icon with bounce-in -->
            <p class="fs-5 mb-1 text-bounce-in" style="color: #495057;"><strong>No Data Available</strong></p>
            <!-- Title with bounce-in -->
            <p class="mb-0 text-bounce-in" style="color: #6c757d;">We couldn't find any records right now. Please add
              new
              entries or try refreshing the page.</p>
          </div>
        </div>
      </td>
    </ng-template>

  </div>
</div>

<ng-template #updateTenantModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title d-flex align-items-center">
      <i class="bi bi-pencil-square me-2"></i> Update Custom Domain
    </h5>
    <button type="button" class="btn-close btn-close-black" aria-label="Close"
      (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="tenantUpdateForm" class="p-3">
      <!-- Tenant ID -->
      <div class="mb-4">
        <label for="tenantId" class="form-label fw-bold d-flex align-items-center">
          <i class="bi bi-person-fill me-2"></i> Tenant ID <span class="text-danger">*</span>
        </label>
        <input type="text" id="tenantId" class="form-control" placeholder="Enter tenant ID" formControlName="tenantId"
          readonly [ngClass]="{
            'is-invalid': tenantUpdateForm.get('tenantId')?.touched && tenantUpdateForm.get('tenantId')?.invalid
          }" />
        <p class="text-danger small mt-1"
          *ngIf="tenantUpdateForm.get('tenantId')?.touched && tenantUpdateForm.get('tenantId')?.errors?.['required']">
          *Tenant ID is required
        </p>
      </div>

      <!-- Custom Domain -->
      <div class="mb-4">
        <label for="customDomain" class="form-label fw-bold d-flex align-items-center">
          <i class="bi bi-globe me-2"></i> Custom Domain <span class="text-danger">*</span>
        </label>
        <input type="text" id="customDomain" class="form-control" placeholder="Enter custom domain name"
          formControlName="customDomain" [ngClass]="{
            'is-invalid': tenantUpdateForm.get('customDomain')?.touched && tenantUpdateForm.get('customDomain')?.invalid
          }" />
        <p class="text-danger small mt-1"
          *ngIf="tenantUpdateForm.get('customDomain')?.touched && tenantUpdateForm.get('customDomain')?.errors?.['required']">
          *Custom domain name is required
        </p>
      </div>

      <!-- SSL Certificate -->
      <div class="mb-4">
        <label for="sslCertificate" class="form-label fw-bold d-flex align-items-center">
          <i class="bi bi-shield-lock-fill me-2"></i> SSL Certificate <span class="text-danger">*</span>
        </label>
        <input type="file" class="form-control" formControlName="sslCertificate" (change)="onFileChangeSsl($event)" />
        <p class="text-danger small mt-1"
          *ngIf="tenantUpdateForm.get('sslCertificate')?.touched && tenantUpdateForm.get('sslCertificate')?.errors?.['required']">
          *SSL Certificate is required
        </p>
      </div>

      <!-- Private Key -->
      <div class="mb-4">
        <label for="privateKey" class="form-label fw-bold d-flex align-items-center">
          <i class="bi bi-key-fill me-2"></i> Private Key <span class="text-danger">*</span>
        </label>
        <input type="file" class="form-control" formControlName="privateKey" (change)="onFileChangeKey($event)" />
        <p class="text-danger small mt-1"
          *ngIf="tenantUpdateForm.get('privateKey')?.touched && tenantUpdateForm.get('privateKey')?.errors?.['required']">
          *Private Key is required
        </p>
      </div>

      <!-- Bundle (Optional) -->
      <div class="mb-4">
        <label for="bundle" class="form-label fw-bold d-flex align-items-center">
          <i class="bi bi-archive-fill me-2"></i> Bundle (Optional)
        </label>
        <input type="file" class="form-control" formControlName="bundle" (change)="onFileChangeBundle($event)" />
      </div>

      <!-- Submit Button -->
      <div class="text-center mt-4">
        <button type="button" class="btn btn-dark w-100 py-2"
          title="Please verify that the data is correct before submitting." (click)="onUpdateTenant();">
          <i class="bi bi-save-fill me-2"></i> Submit
        </button>
      </div>
    </form>
  </div>
</ng-template>




<ng-template #publicModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title text-center w-100"><i class="bi bi-info-circle-fill me-2"></i>Confirm Public Access</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close"></button>
  </div>
  <div class="modal-body text-center">
    <p class="lead text-muted">
      Are you sure you want to make this item public? Once made public, it will be visible to everyone.
    </p>
    <p class="small text-warning">
      Please review your decision carefully before proceeding.
    </p>
  </div>
  <div class="modal-footer justify-content-center">
    <button type="button" class="btn btn-dark btn-lg" (click)="onMakePublic(); modal.close()">
      <i class="bi bi-check-circle me-2"></i> Yes, Make Public
    </button>
    <button type="button" class="btn btn-outline-danger btn-lg" (click)="modal.dismiss('Close click')">
      <i class="bi bi-x-circle me-2"></i> No, Cancel
    </button>
  </div>
</ng-template>


<ng-template #privateModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title text-center w-100"> <i class="bi bi-info-circle-fill me-2"></i>Confirm Private Access</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close"></button>
  </div>
  <div class="modal-body text-center">
    <p class="lead text-muted">
      Are you sure you want to make this item private? Once made private, it will no longer be visible to the public.
    </p>
    <p class="small text-warning">
      Please review your decision carefully before proceeding.
    </p>
  </div>
  <div class="modal-footer justify-content-center">
    <button type="button" class="btn btn-dark btn-lg" (click)="onMakePrivate(); modal.close()">
      <i class="bi bi-check-circle me-2"></i> Yes, Make Private
    </button>
    <button type="button" class="btn btn-outline-danger btn-lg" (click)="modal.dismiss('Close click')">
      <i class="bi bi-x-circle me-2"></i> No, Cancel
    </button>
  </div>
</ng-template>


<ng-template #stopModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title text-center w-100"> <i class="bi bi-info-circle-fill me-2"></i> Confirm Stop</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close"></button>
  </div>
  <div class="modal-body text-center">
    <p class="lead text-muted">
      Are you sure you want to stop this tenant's access? Once stopped, the tenant will no longer have access to the
      system.
    </p>
    <p class="small text-warning">
      Please review your decision carefully before proceeding.
    </p>
  </div>
  <div class="modal-footer justify-content-center">
    <button type="button" class="btn btn-dark btn-lg" (click)="onStopTenant(); modal.close()">
      <i class="bi bi-check-circle me-2"></i> Yes, Stop
    </button>
    <button type="button" class="btn btn-outline-danger btn-lg" (click)="modal.dismiss('Close click')">
      <i class="bi bi-x-circle me-2"></i> No, Cancel
    </button>
  </div>
</ng-template>

<ng-template #restartModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title text-center w-100"> <i class="bi bi-info-circle-fill me-2"></i>Confirm Restart</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close"></button>
  </div>
  <div class="modal-body text-center">
    <p class="lead text-muted">
      Are you sure you want to start this tenant? This action will enable their services and make them active again.
    </p>
    <p class="small text-warning">
      Please review your decision carefully before proceeding.
    </p>
  </div>
  <div class="modal-footer justify-content-center">
    <button type="button" class="btn btn-dark btn-lg" (click)="onRestartTenant(); modal.close()">
      <i class="bi bi-check-circle me-2"></i> Yes, Restart
    </button>
    <button type="button" class="btn btn-outline-danger btn-lg" (click)="modal.dismiss('Close click')">
      <i class="bi bi-x-circle me-2"></i> No, Cancel
    </button>
  </div>
</ng-template>

<ng-template #appleDevModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">
      <i class="bi bi-upload me-2"></i>Upload
    </h5>
    <button type="button" class="btn-close btn-close-black" aria-label="Close"
      (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">

    <div class="mb-4">
      <label for="sslCertificate" class="form-label fw-bold d-flex align-items-center">
        <i class="bi bi-file-earmark-code-fill"></i> Apple Developer File <span class="text-danger">*</span>
      </label>
      <input type="file" class="form-control" [formControl]="appleDevFile" (change)="onFileChangeSsl($event)" />
      <p class="text-danger small mt-1" *ngIf="appleDevFile?.touched && appleDevFile?.errors?.['required']">
        *Apple Developer File is required
      </p>
    </div>

    <!-- Submit Button -->
    <div class="text-center mt-4">
      <button type="button" class="btn btn-outline-dark w-100 py-2"
        (click)="onUpdateTenant(); modal.close('Save click')"
        title="Please ensure that the file is correct before uploading.">
        <i class="bi bi-save-fill me-2"></i>Submit
      </button>
    </div>
  </div>
</ng-template>


<ng-template #createTenantModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">
      <i class="fa fa-user-plus" aria-hidden="true"></i> Create Tenant
    </h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="tenantCreateForm">
      <!-- Domain Name Field -->
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="fa fa-globe"></i> Domain Name</label>
        <select formControlName="domainName" class="form-control" [(ngModel)]="selectedDomain" [ngClass]="{
            'is-invalid': tenantCreateForm.get('domainName')?.touched && tenantCreateForm.get('domainName')?.errors
          }">
          <option disabled value="">Select domain</option>
          <option *ngFor="let domain of domains">{{ domain }}</option>
        </select>
        <div
          *ngIf="tenantCreateForm.get('domainName')?.touched && tenantCreateForm.get('domainName')?.hasError('required')"
          class="text-danger mt-1">
          *Domain is required
        </div>
      </div>

      <!-- Tenant Name Field -->
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="fa fa-user"></i> Tenant Name</label>
        <input type="text" class="form-control" placeholder="Enter tenant name" formControlName="tenantName" [ngClass]="{
                  'is-invalid': tenantCreateForm.get('tenantName')?.touched && tenantCreateForm.get('tenantName')?.errors
                }" />
        <div
          *ngIf="tenantCreateForm.get('tenantName')?.touched && tenantCreateForm.get('tenantName')?.hasError('required')"
          class="text-danger mt-1">
          *Tenant name is required
        </div>
      </div>


      <!-- API Key Field -->
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="fa fa-key"></i> API Key</label>
        <input type="text" class="form-control" placeholder="Enter API key" formControlName="apiKey" [ngClass]="{
            'is-invalid': tenantCreateForm.get('apiKey')?.touched && tenantCreateForm.get('apiKey')?.errors
          }" />
        <div *ngIf="tenantCreateForm.get('apiKey')?.touched && tenantCreateForm.get('apiKey')?.hasError('required')"
          class="text-danger mt-1">
          *API key is required
        </div>
      </div>


      <!-- Email Field -->
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="fa fa-envelope"></i> Email</label>
        <input type="email" class="form-control" placeholder="Enter email" formControlName="email" [ngClass]="{
            'is-invalid': tenantCreateForm.get('email')?.dirty && tenantCreateForm.get('email')?.hasError('email')
          }" />
        <div *ngIf="tenantCreateForm.get('email')?.dirty && tenantCreateForm.get('email')?.hasError('email')"
          class="text-danger mt-1">
          *Invalid email address.
        </div>
      </div>

      <!-- Custom Domain Field -->
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="fa fa-link"></i> Custom Domain</label>
        <input type="text" class="form-control" placeholder="Enter custom domain name" formControlName="customDomain" />
      </div>

      <!-- Submit Button -->
      <div class="text-center mt-4">
        <button type="button" class="btn btn-dark w-100 py-2"
          title="Please verify that the data is correct before submitting." (click)="onCreateTenant();">
          <i class="bi bi-save-fill me-2"></i> Submit
        </button>
      </div>
    </form>
  </div>
</ng-template>